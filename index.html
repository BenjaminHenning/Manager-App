<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Superliga Manager 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #1a7c3e;
    --green-light: #23a854;
    --green-dark: #0f4d26;
    --grass: #1e5c2e;
    --pitch: #217a3a;
    --gold: #f0c040;
    --red: #e03030;
    --white: #f5f5f0;
    --grey: #9ba3a0;
    --dark: #101810;
    --card: #1a2820;
    --bench: #2a3830;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--dark);
    color: var(--white);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* HEADER */
  .header {
    background: linear-gradient(135deg, var(--green-dark) 0%, #0a2a14 100%);
    padding: 16px 20px 12px;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 2px solid var(--green);
  }
  .header-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px;
    letter-spacing: 2px;
    color: var(--gold);
    line-height: 1;
  }
  .header-sub {
    font-size: 11px;
    color: var(--grey);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-top: 2px;
  }

  /* TABS */
  .tabs {
    display: flex;
    background: #0d1a10;
    border-bottom: 1px solid #1f3025;
  }
  .tab {
    flex: 1;
    padding: 12px 4px;
    text-align: center;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    color: var(--grey);
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 3px solid transparent;
  }
  .tab.active {
    color: var(--gold);
    border-bottom-color: var(--gold);
  }

  /* VIEWS */
  .view { display: none; padding: 16px; }
  .view.active { display: block; }

  /* STANDINGS TABLE */
  .standings-card {
    background: var(--card);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 16px;
  }
  .section-label {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 16px;
    letter-spacing: 2px;
    color: var(--gold);
    padding: 14px 16px 10px;
    border-bottom: 1px solid #1f3025;
  }

  .standings-row {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid #1f302510;
    cursor: pointer;
    transition: background 0.15s;
    gap: 10px;
  }
  .standings-row:hover { background: #1f3025; }
  .standings-row:last-child { border-bottom: none; }
  .rank-badge {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 15px;
    flex-shrink: 0;
  }
  .rank-1 { background: var(--gold); color: #000; }
  .rank-2 { background: #b0b8b5; color: #000; }
  .rank-3 { background: #a0724a; color: #fff; }
  .rank-other { background: #1f3025; color: var(--grey); }

  .manager-name {
    flex: 1;
    font-weight: 600;
    font-size: 15px;
  }
  .manager-pts {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px;
    color: var(--green-light);
    letter-spacing: 1px;
  }
  .pts-label {
    font-size: 10px;
    color: var(--grey);
    text-align: right;
    line-height: 1;
    margin-top: -2px;
  }

  /* ROUND PILLS */
  .round-pills {
    display: flex;
    gap: 8px;
    padding: 12px 16px;
    overflow-x: auto;
    scrollbar-width: none;
    background: var(--card);
    border-radius: 12px;
    margin-bottom: 16px;
  }
  .round-pill {
    flex-shrink: 0;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    background: #1f3025;
    color: var(--grey);
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
  }
  .round-pill.active {
    background: var(--green);
    color: white;
    border-color: var(--green-light);
  }

  /* ROUND RESULTS */
  .round-results {
    background: var(--card);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 16px;
  }
  .round-row {
    display: flex;
    align-items: center;
    padding: 10px 16px;
    border-bottom: 1px solid #1f302518;
    gap: 10px;
  }
  .round-row:last-child { border-bottom: none; }
  .round-rank {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;
  }
  .round-manager { flex: 1; font-size: 14px; font-weight: 500; }
  .chain-scores {
    display: flex;
    gap: 4px;
  }
  .chain-pill {
    padding: 2px 7px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
  }
  .chain-k { background: #1e3a5f; color: #60a0e0; }
  .chain-d { background: #1e4a2a; color: #60c880; }
  .chain-m { background: #3a2a10; color: #d0a040; }
  .chain-a { background: #4a1a1a; color: #e07070; }
  .round-total {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    color: var(--gold);
    min-width: 45px;
    text-align: right;
  }

  /* MANAGER SELECTOR */
  .manager-selector {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    scrollbar-width: none;
    margin-bottom: 16px;
    padding: 2px;
  }
  .manager-chip {
    flex-shrink: 0;
    padding: 8px 14px;
    border-radius: 10px;
    font-size: 13px;
    font-weight: 600;
    background: var(--card);
    color: var(--grey);
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
  }
  .manager-chip.active {
    background: var(--green-dark);
    color: white;
    border-color: var(--green);
  }

  /* FOOTBALL PITCH */
  .pitch-wrapper {
    background: var(--card);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 16px;
  }
  .pitch-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid #1f3025;
  }
  .pitch-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 16px;
    letter-spacing: 2px;
    color: var(--gold);
  }
  .round-selector-sm {
    display: flex;
    gap: 4px;
  }
  .round-btn {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: #1f3025;
    color: var(--grey);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all 0.15s;
  }
  .round-btn.active {
    background: var(--green);
    color: white;
    border-color: var(--green-light);
  }

  /* THE PITCH */
  .pitch {
    background:
      linear-gradient(180deg,
        #1e5c2e 0%, #217a3a 8%, #1e5c2e 16%,
        #217a3a 24%, #1e5c2e 32%, #217a3a 40%,
        #1e5c2e 48%, #217a3a 56%, #1e5c2e 64%,
        #217a3a 72%, #1e5c2e 80%, #217a3a 88%, #1e5c2e 100%
      );
    padding: 20px 10px 12px;
    position: relative;
    min-height: 420px;
  }

  /* pitch lines */
  .pitch::before {
    content: '';
    position: absolute;
    top: 0; left: 50%; transform: translateX(-50%);
    width: 1px;
    height: 100%;
    background: rgba(255,255,255,0.12);
  }

  .pitch-row {
    display: flex;
    justify-content: center;
    gap: 4px;
    margin-bottom: 14px;
  }
  .pitch-row.diamond-mid {
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .player-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 72px;
    cursor: pointer;
    transition: transform 0.15s;
  }
  .player-card:active { transform: scale(0.95); }

  .player-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 14px;
    letter-spacing: 0.5px;
    border: 2px solid transparent;
    position: relative;
    margin-bottom: 4px;
  }
  .player-card.active .player-avatar {
    border-color: var(--gold);
    box-shadow: 0 0 10px rgba(240,192,64,0.4);
  }
  .player-card.bench .player-avatar {
    opacity: 0.45;
    border-color: #444;
    filter: grayscale(60%);
  }

  .pos-k { background: #1e3a5f; }
  .pos-d { background: #1a3a22; }
  .pos-m { background: #3a2a10; }
  .pos-a { background: #4a1a1a; }

  .player-pts-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--gold);
    color: #000;
    font-size: 9px;
    font-weight: 700;
    border-radius: 8px;
    padding: 1px 4px;
    line-height: 1.4;
  }
  .player-card.bench .player-pts-badge {
    background: #555;
    color: #aaa;
  }

  .player-name {
    font-size: 9px;
    font-weight: 600;
    text-align: center;
    color: var(--white);
    line-height: 1.2;
    max-width: 68px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .player-club {
    font-size: 8px;
    color: var(--grey);
    text-align: center;
  }
  .player-card.bench .player-name { color: #666; }

  .bench-divider {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px 4px;
    background: var(--bench);
  }
  .bench-divider-line { flex: 1; height: 1px; background: #3a4840; }
  .bench-divider-text {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #555;
  }

  .bench-row {
    background: var(--bench);
    display: flex;
    justify-content: center;
    gap: 6px;
    padding: 8px 10px 14px;
    flex-wrap: wrap;
  }
  .bench-row .player-card { width: 60px; }
  .bench-row .player-avatar { width: 36px; height: 36px; font-size: 12px; }

  /* Diamond midfield layout */
  .diamond-top, .diamond-bottom {
    display: flex;
    justify-content: center;
  }
  .diamond-middle {
    display: flex;
    justify-content: center;
    gap: 60px;
  }

  /* TREND / FORM VIEW */
  .trend-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 16px;
  }
  .trend-card {
    background: var(--card);
    border-radius: 10px;
    padding: 12px;
  }
  .trend-name {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--white);
  }
  .trend-bars {
    display: flex;
    align-items: flex-end;
    gap: 4px;
    height: 40px;
  }
  .trend-bar-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    height: 100%;
    justify-content: flex-end;
  }
  .trend-bar {
    width: 100%;
    border-radius: 3px 3px 0 0;
    background: var(--green);
    transition: height 0.4s ease;
    min-height: 3px;
  }
  .trend-bar.best { background: var(--gold); }
  .trend-rnd {
    font-size: 8px;
    color: var(--grey);
  }
  .trend-total {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 24px;
    color: var(--green-light);
    margin-top: 4px;
  }
  .trend-rank-row {
    display: flex;
    gap: 4px;
    margin-top: 4px;
  }
  .trend-rank-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 9px;
    font-weight: 700;
  }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 200;
    align-items: flex-end;
    justify-content: center;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--card);
    border-radius: 20px 20px 0 0;
    width: 100%;
    max-width: 480px;
    max-height: 85vh;
    overflow-y: auto;
    padding: 20px;
    animation: slideUp 0.3s ease;
  }
  @keyframes slideUp {
    from { transform: translateY(40px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .modal-handle {
    width: 40px; height: 4px;
    background: #3a4840;
    border-radius: 2px;
    margin: -8px auto 16px;
  }
  .modal-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    letter-spacing: 2px;
    color: var(--gold);
    margin-bottom: 16px;
  }
  .modal-round-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #1f3025;
  }
  .modal-round-row:last-child { border-bottom: none; }
  .modal-rnd-label {
    font-size: 13px;
    color: var(--grey);
    font-weight: 500;
  }
  .modal-chains {
    display: flex;
    gap: 4px;
    align-items: center;
  }
  .modal-total {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px;
    color: var(--gold);
    min-width: 50px;
    text-align: right;
  }
  .close-btn {
    display: block;
    width: 100%;
    padding: 12px;
    background: #1f3025;
    border: none;
    border-radius: 10px;
    color: var(--grey);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 16px;
  }

  /* DATA SOURCE CONFIG */
  .config-card {
    background: var(--card);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
  }
  .config-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--grey);
    margin-bottom: 6px;
  }
  .config-input {
    width: 100%;
    background: #0d1a10;
    border: 1px solid #1f3025;
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--white);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    outline: none;
    margin-bottom: 12px;
  }
  .config-input:focus { border-color: var(--green); }
  .config-btn {
    width: 100%;
    padding: 12px;
    background: var(--green);
    border: none;
    border-radius: 10px;
    color: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
  }
  .status-dot {
    display: inline-block;
    width: 8px; height: 8px;
    border-radius: 50%;
    margin-right: 6px;
  }
  .status-dot.live { background: var(--green-light); box-shadow: 0 0 6px var(--green-light); }
  .status-dot.mock { background: var(--gold); }
  .data-notice {
    background: #1a2820;
    border: 1px solid var(--gold);
    border-radius: 10px;
    padding: 12px 14px;
    font-size: 12px;
    color: var(--gold);
    margin-bottom: 16px;
    line-height: 1.5;
  }

  /* LOADING */
  .loading {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px;
    color: var(--grey);
    font-size: 13px;
    gap: 8px;
  }
  .spinner {
    width: 16px; height: 16px;
    border: 2px solid #1f3025;
    border-top-color: var(--green);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div class="header">
  <div style="display:flex;align-items:center;justify-content:space-between;">
    <div>
      <div class="header-title">Superliga Manager</div>
      <div class="header-sub"><span class="status-dot mock" id="statusDot"></span><span id="statusText">Demo-data</span></div>
    </div>
    <div style="font-family:'Bebas Neue',sans-serif;font-size:13px;color:#3a5040;letter-spacing:1px;" id="seasonLabel">2026 FORÅR</div>
  </div>
</div>

<div class="tabs">
  <div class="tab active" onclick="showView('standings')">Stilling</div>
  <div class="tab" onclick="showView('runde')">Runder</div>
  <div class="tab" onclick="showView('hold')">Hold</div>
  <div class="tab" onclick="showView('indstil')">⚙</div>
</div>

<!-- STANDINGS VIEW -->
<div class="view active" id="view-standings">
  <div class="standings-card">
    <div class="section-label">SAMLET STILLING</div>
    <div id="standings-list"></div>
  </div>
</div>

<!-- RUNDE VIEW -->
<div class="view" id="view-runde">
  <div class="round-pills" id="round-pills"></div>
  <div class="round-results" id="round-results">
    <div class="loading"><div class="spinner"></div> Henter...</div>
  </div>
</div>

<!-- HOLD VIEW -->
<div class="view" id="view-hold">
  <div class="manager-selector" id="manager-selector"></div>
  <div class="pitch-wrapper" id="pitch-wrapper">
    <div class="pitch-header">
      <div class="pitch-title" id="pitch-manager-label">Vælg manager</div>
      <div class="round-selector-sm" id="pitch-round-selector"></div>
    </div>
    <div id="pitch-container"></div>
  </div>
</div>

<!-- INDSTILLINGER VIEW -->
<div class="view" id="view-indstil">
  <div class="data-notice" id="data-notice">
    ⚠ Viser demo-data. Tryk "Hent live data" for at hente dit rigtige sheet.
  </div>
  <div class="config-card">
    <div class="config-label">Apps Script URL</div>
    <input class="config-input" id="appsScriptUrl" value="https://script.google.com/macros/s/AKfycbx1rDKbz9xFgJH5Ed2J-kgv0gX3HUEAHqziHbgh2ckryGzY3n-9vNbeJyvCrFifUQ3L/exec" placeholder="https://script.google.com/macros/s/...">
    <button class="config-btn" onclick="connectSheet()">Hent live data</button>
  </div>
  <div class="config-card" style="font-size:12px;color:var(--grey);line-height:1.7;">
    <strong style="color:var(--white);font-size:13px;">Din URL er allerede sat ind ✅</strong><br><br>
    Tryk bare på "Hent live data" herover. Hvis du nogensinde laver et nyt Apps Script, kan du indsætte den nye URL her.
  </div>
</div>

<!-- MODAL: Manager detaljer -->
<div class="modal-overlay" id="modal" onclick="closeModal(event)">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modal-title"></div>
    <div id="modal-content"></div>
    <button class="close-btn" onclick="closeModal()">Luk</button>
  </div>
</div>

<script>
// ========== DEMO DATA ==========
const DEMO_SCORESHEET = [
  // Runde 1
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Keeper",Spiller:"Jesper Hansen",Vækst:54000,Klub:"AGF"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Keeper",Spiller:"Kamil Grabara",Vækst:18000,Klub:"FCK"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Forsvar",Spiller:"Kevin Diks",Vækst:32000,Klub:"AGF"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Forsvar",Spiller:"Alexander Scholz",Vækst:12000,Klub:"FC Midtjylland"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Forsvar",Spiller:"Mikkel Rygaard",Vækst:8000,Klub:"FCK"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Forsvar",Spiller:"Erik Marxen",Vækst:-1000,Klub:"BIF"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Forsvar",Spiller:"Nicolai Poulsen",Vækst:5000,Klub:"SønderjyskE"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Forsvar",Spiller:"Lasse Berg Laursen",Vækst:22000,Klub:"FC Midtjylland"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Midtbane",Spiller:"Evander",Vækst:48000,Klub:"FC Midtjylland"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Midtbane",Spiller:"Mathias Jensen",Vækst:35000,Klub:"BIF"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Midtbane",Spiller:"Lukas Lerager",Vækst:28000,Klub:"FCK"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Midtbane",Spiller:"Rasmus Falk",Vækst:-2000,Klub:"FCK"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Midtbane",Spiller:"Mathias Greve",Vækst:15000,Klub:"RANDERS"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Midtbane",Spiller:"Anders Dreyer",Vækst:20000,Klub:"BIF"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Angreb",Spiller:"Nicolai Vallys",Vækst:42000,Klub:"BIF"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Angreb",Spiller:"David Nielsen",Vækst:18000,Klub:"AGF"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Angreb",Spiller:"Gustav Isaksen",Vækst:55000,Klub:"FC Midtjylland"},
  {Runde:1,År:"2026 Forår",Ejer:"Nicolai",Position:"Angreb",Spiller:"Søren Tengstedt",Vækst:-3000,Klub:"FCK"},

  // Benjamin runde 1
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Keeper",Spiller:"Nicolai Larsen",Vækst:22000,Klub:"OB"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Keeper",Spiller:"Peter Vindahl",Vækst:8000,Klub:"AaB"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Forsvar",Spiller:"Oliver Villadsen",Vækst:-1000,Klub:"BIF"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Forsvar",Spiller:"Joel Andersson",Vækst:35000,Klub:"FCK"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Forsvar",Spiller:"Mads Pedersen",Vækst:42000,Klub:"FC Midtjylland"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Forsvar",Spiller:"Simon Kroon",Vækst:12000,Klub:"SønderjyskE"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Forsvar",Spiller:"Jens Martin Gammelby",Vækst:5000,Klub:"AaB"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Forsvar",Spiller:"Kasper Barsholt",Vækst:18000,Klub:"OB"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Midtbane",Spiller:"Sory Kaba",Vækst:62000,Klub:"BIF"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Midtbane",Spiller:"Kian Hansen",Vækst:25000,Klub:"AaB"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Midtbane",Spiller:"Mohammed Kudus",Vækst:88000,Klub:"FCK"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Midtbane",Spiller:"Mikkel Anderson",Vækst:-5000,Klub:"OB"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Midtbane",Spiller:"Emil Riis",Vækst:45000,Klub:"FC Midtjylland"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Midtbane",Spiller:"Lasse Vibe",Vækst:10000,Klub:"AGF"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Angreb",Spiller:"Anders Christiansen",Vækst:38000,Klub:"OB"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Angreb",Spiller:"Mikkel Damsgaard",Vækst:70000,Klub:"FCK"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Angreb",Spiller:"Anis Slimane",Vækst:30000,Klub:"BIF"},
  {Runde:1,År:"2026 Forår",Ejer:"Benjamin",Position:"Angreb",Spiller:"Kasper Junker",Vækst:-2000,Klub:"AGF"},
];

// Generate demo data for remaining managers and rounds 2-3
const managers = ["Nicolai","Benjamin","Kaya","Mads","Lars","Simon","Jonas"];
const clubs = ["FCK","BIF","AGF","FC Midtjylland","OB","AaB","RANDERS","SønderjyskE","Viborg","Silkeborg"];
const keeperPool = ["Jesper Hansen","Kamil Grabara","Nicolai Larsen","Peter Vindahl","Matej Kovář","Nicolai Floe","Andreas Hansen"];
const defPool = ["Kevin Diks","Alexander Scholz","Mads Pedersen","Joel Andersson","Oliver Villadsen","Erik Marxen","Lasse Berg Laursen","Mikkel Rygaard","Simon Kroon","Jens Martin Gammelby","Kasper Barsholt","Nicolas Haas","Mathias Dyngeland","Victor Lind"];
const midPool = ["Evander","Mathias Jensen","Lukas Lerager","Mohammed Kudus","Sory Kaba","Emil Riis","Rasmus Falk","Mathias Greve","Anders Dreyer","Kian Hansen","Mikkel Anderson","Lasse Vibe","Anders Christiansen","William Bøving","Ibrahim Sadiq"];
const attPool = ["Nicolai Vallys","David Nielsen","Gustav Isaksen","Mikkel Damsgaard","Anis Slimane","Kasper Junker","Søren Tengstedt","Sory Kaba","Mohamed Diomande","Simon Adingra"];

let allScores = [...DEMO_SCORESHEET];

// Fill demo for other managers round 1 and all rounds 2-3
managers.slice(2).forEach((mgr, mi) => {
  const seed = mi * 13;
  [1,2,3].forEach(rnd => {
    const rndSeed = seed + rnd * 7;
    let row = (rndSeed) % keeperPool.length;
    [[keeperPool,2,"Keeper"],[defPool,6,"Forsvar"],[midPool,6,"Midtbane"],[attPool.slice(0,8),4,"Angreb"]].forEach(([pool,count,pos]) => {
      for(let i=0;i<count;i++){
        const idx = (row + i*3 + rndSeed) % pool.length;
        const v = (Math.floor(Math.random()*150)-20)*1000;
        allScores.push({Runde:rnd,År:"2026 Forår",Ejer:mgr,Position:pos,Spiller:pool[idx],Vækst:v,Klub:clubs[idx%clubs.length]});
      }
      row = (row + count) % pool.length;
    });
  });
});

// Fill Nicolai and Benjamin rounds 2-3
["Nicolai","Benjamin"].forEach((mgr,mi) => {
  const existing = allScores.filter(r=>r.Ejer===mgr).map(r=>r.Spiller);
  [2,3].forEach(rnd => {
    const seed = mi*7 + rnd*11;
    [[keeperPool,2,"Keeper"],[defPool,6,"Forsvar"],[midPool,6,"Midtbane"],[attPool.slice(0,8),4,"Angreb"]].forEach(([pool,count,pos],pi) => {
      for(let i=0;i<count;i++){
        const idx=(seed+i*5+pi*3)%pool.length;
        const v=(Math.floor(Math.random()*150)-20)*1000;
        allScores.push({Runde:rnd,År:"2026 Forår",Ejer:mgr,Position:pos,Spiller:pool[idx],Vækst:v,Klub:clubs[idx%clubs.length]});
      }
    });
  });
});

// ========== SCORING LOGIC ==========
function calcManagerScore(ejer, runde) {
  const rows = allScores.filter(r => r.Ejer === ejer && r.Runde === runde);
  const byPos = pos => rows.filter(r=>r.Position===pos).sort((a,b)=>b.Vækst-a.Vækst);
  const k = byPos("Keeper"), d = byPos("Forsvar"), m = byPos("Midtbane"), a = byPos("Angreb");
  const topK = k.slice(0,1).reduce((s,r)=>s+r.Vækst,0);
  const topD = d.slice(0,4).reduce((s,r)=>s+r.Vækst,0);
  const topM = m.slice(0,4).reduce((s,r)=>s+r.Vækst,0);
  const topA = a.slice(0,2).reduce((s,r)=>s+r.Vækst,0);
  return {k:topK, d:topD, m:topM, a:topA, total:topK+topD+topM+topA};
}

function getAllRoundes() {
  return [...new Set(allScores.map(r=>r.Runde))].sort((a,b)=>a-b);
}

function getStandings() {
  const rounds = getAllRoundes();
  return managers.map(mgr => {
    let total = 0;
    const roundScores = rounds.map(rnd => {
      const s = calcManagerScore(mgr, rnd);
      total += s.total;
      return {runde:rnd, ...s};
    });
    return {mgr, total, roundScores};
  }).sort((a,b)=>b.total-a.total);
}

// ========== STATE ==========
let selectedRound = 1;
let selectedManager = managers[0];
let selectedPitchRound = 1;
const rounds = getAllRoundes();

// ========== RENDER STANDINGS ==========
function renderStandings() {
  const standings = getStandings();
  const list = document.getElementById('standings-list');
  list.innerHTML = standings.map((s,i) => {
    const rankClass = i===0?'rank-1':i===1?'rank-2':i===2?'rank-3':'rank-other';
    return `<div class="standings-row" onclick="openManagerModal('${s.mgr}')">
      <div class="rank-badge ${rankClass}">${i+1}</div>
      <div class="manager-name">${s.mgr}</div>
      <div>
        <div class="manager-pts">${fmt(s.total)}</div>
        <div class="pts-label">KR</div>
      </div>
    </div>`;
  }).join('');
}

// ========== RENDER RUNDE ==========
function renderRoundPills() {
  const pills = document.getElementById('round-pills');
  pills.innerHTML = rounds.map(r =>
    `<div class="round-pill ${r===selectedRound?'active':''}" onclick="selectRound(${r})">Runde ${r}</div>`
  ).join('');
}

function renderRoundResults() {
  const container = document.getElementById('round-results');
  const roundData = managers.map(mgr => {
    const s = calcManagerScore(mgr, selectedRound);
    return {mgr, ...s};
  }).sort((a,b)=>b.total-a.total);

  container.innerHTML = `<div class="section-label">RUNDE ${selectedRound} — RESULTATER</div>` +
    roundData.map((s,i) => {
      const rankClass = i===0?'rank-1':i===1?'rank-2':i===2?'rank-3':'rank-other';
      return `<div class="round-row">
        <div class="round-rank ${rankClass}">${i+1}</div>
        <div class="round-manager">${s.mgr}</div>
        <div class="chain-scores">
          <span class="chain-pill chain-k">${fmt(s.k)}</span>
          <span class="chain-pill chain-d">${fmt(s.d)}</span>
          <span class="chain-pill chain-m">${fmt(s.m)}</span>
          <span class="chain-pill chain-a">${fmt(s.a)}</span>
        </div>
        <div class="round-total">${fmt(s.total)}</div>
      </div>`;
    }).join('');
}

function selectRound(r) {
  selectedRound = r;
  renderRoundPills();
  renderRoundResults();
}

// ========== RENDER HOLD / PITCH ==========
function renderManagerSelector() {
  const sel = document.getElementById('manager-selector');
  sel.innerHTML = managers.map(m =>
    `<div class="manager-chip ${m===selectedManager?'active':''}" onclick="selectManager('${m}')">${m}</div>`
  ).join('');
}

function renderPitchRoundSelector() {
  const sel = document.getElementById('pitch-round-selector');
  sel.innerHTML = rounds.map(r =>
    `<div class="round-btn ${r===selectedPitchRound?'active':''}" onclick="selectPitchRound(${r})">${r}</div>`
  ).join('');
}

function renderPitch() {
  document.getElementById('pitch-manager-label').textContent = `${selectedManager} — R${selectedPitchRound}`;
  const rows = allScores.filter(r=>r.Ejer===selectedManager && r.Runde===selectedPitchRound);
  const byPos = pos => rows.filter(r=>r.Position===pos).sort((a,b)=>b.Vækst-a.Vækst);

  const keepers = byPos("Keeper");
  const defenders = byPos("Forsvar");
  const midfielders = byPos("Midtbane");
  const attackers = byPos("Angreb");

  const pitchK = keepers.slice(0,1), benchK = keepers.slice(1);
  const pitchD = defenders.slice(0,4), benchD = defenders.slice(4);
  const pitchM = midfielders.slice(0,4), benchM = midfielders.slice(4);
  const pitchA = attackers.slice(0,2), benchA = attackers.slice(2);

  function playerCard(p, active, small=false) {
    const posClass = p.Position==="Keeper"?"pos-k":p.Position==="Forsvar"?"pos-d":p.Position==="Midtbane"?"pos-m":"pos-a";
    const initials = p.Spiller.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase();
    const pts = fmt(p.Vækst);
    const name = p.Spiller.split(' ').slice(-1)[0];
    return `<div class="player-card ${active?'active':'bench'}">
      <div class="player-avatar ${posClass}">
        ${initials}
        <div class="player-pts-badge">${pts}</div>
      </div>
      <div class="player-name">${name}</div>
      <div class="player-club">${p.Klub}</div>
    </div>`;
  }

  // Diamond: top=1, middle=2, bottom=1
  const dmTop = pitchM[0], dmLeft = pitchM[1], dmRight = pitchM[2], dmBottom = pitchM[3];

  let html = `
    <div class="pitch">
      <div class="pitch-row">${pitchA.map(p=>playerCard(p,true)).join('')}</div>
      <div class="pitch-row" style="justify-content:center;">${dmTop ? playerCard(dmTop,true) : ''}</div>
      <div class="pitch-row">${[dmLeft,dmRight].filter(Boolean).map(p=>playerCard(p,true)).join('')}</div>
      <div class="pitch-row" style="justify-content:center;">${dmBottom ? playerCard(dmBottom,true) : ''}</div>
      <div class="pitch-row">${pitchD.map(p=>playerCard(p,true)).join('')}</div>
      <div class="pitch-row">${pitchK.map(p=>playerCard(p,true)).join('')}</div>
    </div>
    <div class="bench-divider">
      <div class="bench-divider-line"></div>
      <div class="bench-divider-text">Bænk</div>
      <div class="bench-divider-line"></div>
    </div>
    <div class="bench-row">
      ${[...benchK,...benchD,...benchM,...benchA].map(p=>playerCard(p,false,true)).join('')}
    </div>
  `;

  document.getElementById('pitch-container').innerHTML = html;
}

function selectManager(m) {
  selectedManager = m;
  renderManagerSelector();
  renderPitch();
}

function selectPitchRound(r) {
  selectedPitchRound = r;
  renderPitchRoundSelector();
  renderPitch();
}

// ========== MODAL ==========
function openManagerModal(mgr) {
  const rounds = getAllRoundes();
  document.getElementById('modal-title').textContent = mgr.toUpperCase();
  const content = rounds.map(rnd => {
    const s = calcManagerScore(mgr, rnd);
    return `<div class="modal-round-row">
      <div class="modal-rnd-label">Runde ${rnd}</div>
      <div class="modal-chains">
        <span class="chain-pill chain-k">${fmt(s.k)}</span>
        <span class="chain-pill chain-d">${fmt(s.d)}</span>
        <span class="chain-pill chain-m">${fmt(s.m)}</span>
        <span class="chain-pill chain-a">${fmt(s.a)}</span>
      </div>
      <div class="modal-total">${fmt(s.total)}</div>
    </div>`;
  }).join('');
  document.getElementById('modal-content').innerHTML = content;
  document.getElementById('modal').classList.add('open');
}

function closeModal(e) {
  if (!e || e.target === document.getElementById('modal')) {
    document.getElementById('modal').classList.remove('open');
  }
}

// ========== TABS ==========
function showView(id) {
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('view-'+id).classList.add('active');
  event.target.classList.add('active');
}

// ========== GOOGLE APPS SCRIPT CONNECT ==========
function connectSheet() {
  const url = document.getElementById('appsScriptUrl').value.trim();
  if(!url) { alert("Indsæt venligst Apps Script URL"); return; }

  const notice = document.getElementById('data-notice');
  notice.style.borderColor = 'var(--gold)';
  notice.style.color = 'var(--gold)';
  notice.textContent = "⏳ Henter data fra Google Sheet...";

  fetch(url)
    .then(r => {
      if(!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.json();
    })
    .then(data => {
      if(!data.scoresheet) throw new Error("Uventet dataformat — tjek Apps Script koden");

      const rows = data.scoresheet;
      if(rows.length < 2) throw new Error("Ingen data i Scoresheet");

      // First row is headers
      const headers = rows[0].map(h => String(h).trim());
      const rundeIdx   = headers.findIndex(h => h.toLowerCase().includes('runde'));
      const aarIdx     = headers.findIndex(h => h.toLowerCase().includes('år') || h.toLowerCase().includes('ar'));
      const ejerIdx    = headers.findIndex(h => h.toLowerCase().includes('ejer'));
      const posIdx     = headers.findIndex(h => h.toLowerCase().includes('position'));
      const spillerIdx = headers.findIndex(h => h.toLowerCase().includes('spiller'));
      const vaekstIdx  = headers.findIndex(h => h.toLowerCase().includes('v'));
      const klubIdx    = headers.findIndex(h => h.toLowerCase().includes('klub'));

      allScores = rows.slice(1)
        .map(row => ({
          Runde:    parseInt(row[rundeIdx >= 0 ? rundeIdx : 0]),
          År:       String(row[aarIdx >= 0 ? aarIdx : 1] || ''),
          Ejer:     String(row[ejerIdx >= 0 ? ejerIdx : 2] || '').trim(),
          Position: String(row[posIdx >= 0 ? posIdx : 3] || '').trim(),
          Spiller:  String(row[spillerIdx >= 0 ? spillerIdx : 4] || '').trim(),
          Vækst:    parseFloat(row[vaekstIdx >= 0 ? vaekstIdx : 5]) || 0,
          Klub:     String(row[klubIdx >= 0 ? klubIdx : 6] || '').trim(),
        }))
        .filter(r => r.Runde && r.Ejer && r.Spiller);

      if(allScores.length === 0) throw new Error("Ingen gyldige rækker fundet — tjek kolonnenavne i sheetet");

      // Derive managers from real data
      const liveMgrs = [...new Set(allScores.map(r=>r.Ejer))];
      managers.length = 0;
      liveMgrs.forEach(m => managers.push(m));

      document.getElementById('statusDot').className = 'status-dot live';
      document.getElementById('statusText').textContent = 'Live data';
      notice.textContent = `✅ Forbundet! ${allScores.length} rækker • ${managers.length} managere`;
      notice.style.borderColor = 'var(--green-light)';
      notice.style.color = 'var(--green-light)';

      selectedManager = managers[0];
      renderAll();
    })
    .catch(err => {
      notice.style.borderColor = 'var(--red)';
      notice.style.color = 'var(--red)';
      notice.textContent = `❌ Fejl: ${err.message}`;
    });
}

// ========== FORMAT ==========
function fmt(v) {
  if(v >= 1000000) return (v/1000000).toFixed(1)+'M';
  if(Math.abs(v) >= 1000) return Math.round(v/1000)+'k';
  return v;
}

// ========== INIT ==========
function renderAll() {
  selectedRound = getAllRoundes()[0] || 1;
  selectedPitchRound = getAllRoundes()[0] || 1;
  renderStandings();
  renderRoundPills();
  renderRoundResults();
  renderManagerSelector();
  renderPitchRoundSelector();
  renderPitch();
}

renderAll();
</script>
</body>
</html>
